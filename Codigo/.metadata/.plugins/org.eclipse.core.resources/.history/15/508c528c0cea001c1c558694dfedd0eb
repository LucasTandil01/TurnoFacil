package Clases;
import java.awt.EventQueue;
import java.util.ArrayList;
import java.util.Scanner;

import javax.swing.JButton;

import Swing.*;

public class TurnoFacil {
	private ArrayList<Usuario> usuarios;
	private boolean registro;
	//private Scanner scan;
	
	public TurnoFacil() {
		usuarios = new ArrayList<Usuario>();
	}
	
	public boolean existeUsuario(long dni) {
		int i = 0;
		int j = usuarios.size() - 1;
		int k;
		long dniAux;
		while (i<=j) {
			k = (i+j)/2;
			dniAux = usuarios.get(k).getDni();
			if(dni == dniAux)
				return true;
			if(dni<dniAux) j = k+1;
			else i = k-1;
		}
		return false;
	}
	
	public void login(long dni) throws InterruptedException {
//		if(!existeUsuario(dni))
			Paciente p = registrarPaciente(dni);
		//...
		PortalUsuario pu = new PortalUsuario(p);
		pu.main(null);

	}
	
	private Paciente registrarPaciente(long dni) throws InterruptedException {
		registro = false;
		Paciente p = new Paciente();
		TurnoFacil t = this;
		RegisterFrame rf = new RegisterFrame(dni,t);
		EventQueue.invokeLater(new Runnable() {
			public void run() {
				try {
					rf.setVisible(true);
				} catch (Exception e) {
					e.printStackTrace();
				}
			}
		});
//		System.out.println("Ingrese nombre: ");
//		String nombre = scan.nextLine();
//		//...			
		JButton b = rf.getButton();
		synchronized(b) {
            try {                
                b.wait();
            } catch (InterruptedException ex) {
                System.out.println("Interrupted");
            }
        }
        System.out.println("After button clicked");
		p = rf.getPaciente();
		return p;
	}
	
	public void setRegistro(boolean registro) {this.registro = registro;}
	
	public void addUser(Usuario u) {
		if(!existeUsuario(u.getDni())) usuarios.add(u);
	}
}
